#:schema https://jj-vcs.github.io/jj/latest/config-schema.json
# <%# vim: set filetype=eruby.toml : -%>
# <%= variables.figManaged %>

[aliases]
tug = ["util", "exec", "--", "sh", "-c", """
source ~/.config/jj/helpers.sh

if [ "$#" -gt 1 ]; then
  jj_error "jj tug: expected 0 or 1 arguments, got: $*"
  jj_hint "Target multiple branches with ``|`` or ``&`` or ``~``)"
  exit 1
elif [ -n "$1" ]; then
  jj bookmark move --to "closest_pushable(@)" "$@"
else
  jj bookmark move --from "closest_bookmark(@)" --to "closest_pushable(@)"
fi
""", ""]

[colors]
# See also overrides in ~/.config/jj/conf.d/colors.toml (maintained by `color`
# command, so as to have colors that look good in both light and dark schemes).
"diff removed token" = { underline = false }
"diff added token" = { underline = false }

[revset-aliases]
'closest_bookmark(to)' = 'heads(::to & bookmarks())'
'closest_pushable(to)' = 'heads(::to & mutable() & ~description(exact:"") & (~empty() | merges()))'

[signing]
<%- if (variables.vcsGpgSign) { -%>
behavior = "own"
backend = "gpg"
backends.gpg.program = "<%= variables.home %>/.zsh/bin/vcs-gpg"
<%- } -%>

[template-aliases]
'format_short_change_id(id)' = 'id.shortest()'
'format_change_id_trailer(commit)' = '"Change-Id: " ++ commit.change_id() ++ "\n"'

[templates]
commit_trailers = '''
if(!trailers.contains_key("Change-Id"), format_change_id_trailer(self))
'''
draft_commit_description = '''
concat(
  coalesce(description, default_commit_description, "\n"),
  surround(
    "\nJJ: This commit contains the following changes:\n", "",
    indent("JJ:     ", diff.stat(72)),
  ),
  "\nJJ: ignore-rest\n",
  diff.git(),
)
'''
<%- if (variables.gitHubUsername) { -%>

# Generate prefixed bookmark names when running `jj git push --change`:
# See: https://jj-vcs.github.io/jj/latest/config/#generated-bookmark-names-on-push
git_push_bookmark = '"<%= variables.gitHubUsername %>/" ++ change_id.short()'
<%- } -%>

[ui]
default-command = "log"
diff-editor = ":builtin"
# diff-formatter = ":git"
# pager = "delta"

[user]
<%- if (variables.vcsUserName) { -%>
  name = "<%= variables.vcsUserName %>"
<%- } -%>
<%- if (variables.vcsUserEmail) { -%>
  email = "<%= variables.vcsUserEmail %>"
<%- } -%>
