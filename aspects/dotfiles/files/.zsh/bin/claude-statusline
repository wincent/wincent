#!/bin/bash
input=$(cat)

MODEL=$(echo "$input" | jq -r '.model.display_name')
PCT=$(echo "$input" | jq -r '.context_window.used_percentage // 0' | cut -d. -f1)
DURATION_MS=$(echo "$input" | jq -r '.cost.total_duration_ms // 0')

CYAN='\033[36m'
YELLOW='\033[33m'
RED='\033[31m'
RESET='\033[0m'

if [ "$PCT" -ge 75 ]; then
  PCT_COLOR="$RED"
elif [ "$PCT" -ge 50 ]; then
  PCT_COLOR="$YELLOW"
else
  PCT_COLOR="$CYAN"
fi

DURATION_SEC=$((DURATION_MS / 1000))
MINS=$((DURATION_SEC / 60))
SECS=$((DURATION_SEC % 60))

printf '%b\n' "${PCT_COLOR}${PCT}%${RESET} context · $MODEL · ${MINS}m ${SECS}s"
