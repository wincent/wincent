#:schema https://jj-vcs.github.io/jj/latest/config-schema.json

[aliases]
tug = ["util", "exec", "--", "sh", "-c", """
source ~/.config/jj/helpers.sh

if [ "$#" -gt 1 ]; then
  jj_error "jj tug: expected 0 or 1 arguments, got: $*"
  jj_hint "Target multiple branches with ``|`` or ``&`` or ``~``)"
  exit 1
elif [ -n "$1" ]; then
  jj bookmark move --to "closest_pushable(@)" "$@"
else
  jj bookmark move --from "closest_bookmark(@)" --to "closest_pushable(@)"
fi
""", ""]

[colors]
# Remove unreadable underline styling.
# TODO: find a way to do this without hard-coding (won't look good for all color
# schemes).
"diff removed token" = { bg = "#221111", underline = false }
"diff added token" = { bg = "#002200", underline = false }

[revset-aliases]
'closest_bookmark(to)' = 'heads(::to & bookmarks())'
'closest_pushable(to)' = 'heads(::to & mutable() & ~description(exact:"") & (~empty() | merges()))'

[signing]
behavior = "own"
backend = "gpg"

[template-aliases]
'format_short_change_id(id)' = 'id.shortest()'

[templates]
draft_commit_description = '''
concat(
  coalesce(description, default_commit_description, "\n"),
  surround(
    "\nJJ: This commit contains the following changes:\n", "",
    indent("JJ:     ", diff.stat(72)),
  ),
  "\nJJ: ignore-rest\n",
  diff.git(),
)
'''

[ui]
default-command = "log"
diff-editor = ":builtin"
# diff-formatter = ":git"
# pager = "delta"

[user]
name = "Greg Hurrell"
email = "greg.hurrell@datadoghq.com"

# Note: can't do per-directory override of email, because GPG signing will fail.
